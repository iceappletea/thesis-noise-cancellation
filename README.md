# 🎓 Master's Thesis Project – STM32-Based Active Noise Cancellation System  
碩士論文專案：基於 STM32 之主動式噪聲抵銷雙系統設計

This repository documents my graduate thesis project, which involves the development of a dual-system active noise cancellation (ANC) platform. The system is designed to simulate low-frequency noise from wind turbines and perform real-time spectrum analysis, acoustic interference, and visualization using embedded platforms and web technologies.

> 📌 中文補充：本倉庫紀錄本人碩士論文專案內容，包含一套用於模擬與抑制風力發電機低頻噪聲的嵌入式雙系統架構，實現即時頻譜分析、聲波干涉與視覺化操作。

---

## 🔗 Subsystem Repositories

- 📊 [FFT + MQTT HTML Display Subsystem](https://github.com/iceappletea/stm32f103-fft-display-mqtt-html)  
- 📈 [LVGL Real-time Spectrum Display](https://github.com/iceappletea/lvgl-fft-display)  
- 🔧 [PID Controller Simulation (Python + PyQt)](https://github.com/iceappletea/pid-simulator)

---

## 🌀 Dynamic System Architecture

### 1. Noise Generation Module (Fixed-position smartphone)
A fixed smartphone continuously plays a 400 Hz sine wave to simulate low-frequency noise generated by wind turbines. This provides a stable and controllable background noise source.

> 📌 中文補充：使用固定手機持續播放 400Hz 正弦波，模擬風機運作時之穩定低頻噪聲。

---

### 2. Noise Localization and Spectrum Analysis Module (Self-balancing car)
Two STM32 microcontrollers are used in tandem: one controls vehicle stability, and the other performs FFT analysis of environmental sound.

**STM32-A: Balance control**
- MPU6050 for tilt sensing and self-balancing.
- HC-05 Bluetooth module to receive remote movement commands.
- PID control for upright posture and movement stabilization.

**STM32-B: FFT spectrum analysis**
- Captures environmental audio and computes a FFT.
- Uses SPI to alternate control of two ST7789 LCDs displaying:
  - Time-domain waveform
  - Frequency-domain spectrum (peak frequency and amplitude)
- Rotary encoder for horizontal scaling and zoom.
- ESP8266 transmits FFT results (frequency and amplitude) via MQTT.
- Frontend (HTML + MQTT.js + Chart.js) displays the latest 20 FFT data points for amplitude trend observation.

> 📌 中文補充：本模組透過雙 STM32 分別處理自平衡與頻譜分析，並將主頻資料透過 MQTT 傳送至網頁前端即時視覺化。

---

### 3. Active Interference Module (Follower car)
This module follows the FFT car and emits a sound signal to interfere with the dominant noise frequency using both frequency and phase tuning.

**Tracking and Obstacle Avoidance**
- OpenMV camera tracks the AprilTag on the front vehicle.
- HC-SR04 ultrasonic sensor acts as backup distance sensing.

**Interference Output**
- STM32 DAC outputs a sinusoidal wave with adjustable frequency and phase, played through a speaker.
- A single rotary encoder + mode toggle button allows:
  - Frequency scan (e.g., from 395 to 405 Hz) to find the interference dip.
  - Phase tuning mode to fine-tune phase angle for maximum suppression.

**Display**
- ST7789 LCD shows current output frequency, phase, and detected FFT amplitude.

**Result Observation**
- FFT module continues uploading frequency/amplitude to MQTT broker.
- Chart.js frontend presents interference effect via amplitude trend chart.

> 📌 中文補充：該模組會追蹤分析車並發出正弦波，透過頻率與相位調整達成主頻的破壞性干涉，並由前車回傳 FFT 資料供視覺化觀察。

---

## 🧱 Static System Architecture

### 1. Noise Generation Module (Wind turbine simulation)
A motorized fan assembly simulates wind turbine behavior and emits low-frequency noise.

**Hardware**
- ESP32-WROOM-32E microcontroller
- TB6612 motor driver + 720 hollow cup motor
- MPU6050 for posture sensing
- PID-based motor balance control

> 📌 中文補充：使用 ESP32 控制風扇裝置模擬風機，具備穩定輸出與擾動能力。

---

### 2. Spectrum Display and Interaction Module (LVGL + React)
**Display UI**
- Touch-enabled LCD using LVGL library
- Three toggle buttons to display: waveform / spectrum / raw data
- Two sliders to control zoom and display range

**Security**
- OpenMV performs image recognition to unlock the system using password pattern A18B305

**Data Sources**
- ESP8266 transmits FFT spectrum
- LAN8720 (Ethernet) transmits raw ADC waveform

**Frontend**
- React-based interface merges FFT and ADC into a single interactive chart
- Users can toggle layers and observe waveform-spectral overlap
- Repaints with each update, supporting real-time FFT visualization

> 📌 中文補充：使用 React 製作網頁前端，整合頻譜與波形資訊並可即時互動與切換圖層觀察結果。

---

### 3. Interference Output Module (Fixed-point)
This module shares a similar DAC output mechanism with the dynamic system but omits motion and tracking. It is used in static interference experiments.

**Operation**
- Rotary encoder adjusts output frequency and phase
- Toggle button switches between frequency scan and phase tuning modes
- ST7789 LCD displays current output status for reference

> 📌 中文補充：與動態模組共用聲波輸出架構，可手動調整頻率與相位並觀察主頻干涉效果。

---

## 🛠️ Key Technologies & Hardware

| Category | Description |
|----------|-------------|
| **Microcontrollers** | STM32F103 (self-balancing, FFT), STM32F407 (DAC output), ESP8266 (MQTT communication), ESP32-WROOM-32E (motor/fan control) |
| **Sensors** | MPU6050 (IMU for PID balance), HC-SR04 (ultrasonic backup), OpenMV (AprilTag visual tracking), Rotary Encoder |
| **Signal Processing** | Real-time FFT, DMA + ADC sampling, DAC sinusoidal output, PID loop control |
| **Displays** | ST7789 (dual LCD with waveform/spectrum), LVGL touchscreen UI (static system), React + Chart.js (frontend visualization) |
| **Communication** | UART (inter-MCU & Bluetooth), MQTT (via ESP8266), LAN8720 Ethernet (streaming ADC waveform) |
| **Power & Motor** | TB6612 motor driver, DAC + speaker for acoustic output |
| **Frontend Web** | React.js, MQTT.js, Chart.js – real-time UI with layer toggle, FFT & waveform overlay, zoom control |
| **Security & Interaction** | OpenMV image pattern lock (A18B305), encoder-controlled frequency & phase sweep, mode toggle button |

> 📌 中文補充：系統整合了多種感測、顯示與通訊模組，並實作 FFT 與干涉控制核心邏輯。
